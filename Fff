import os
import pandas as pd

# === CATEGORY DICTIONARIES ===
internal_sanctions = [
    "PB_PPL", "BARCCAP", "BPROHIB", "UAEPRV", "TRADE_PRV"
]

internal_non_sanctions = [
    "CBI-NY", "WTR_MTO", "WTR_MTI", "USPRV-GAME", "ITA_LAW185", "US_LEGAL_FREEZE_PRV"
]

supplementary_regulatory = [
    "DELTA_LIST", "BPRV", "ECVESPRV", "ChinaEO13959_PRV", "PORTUGAL_PRV",
    "SSILPRV", "Kharon_PRV", "00069295_PRV", "MAS_RGA", "MAS_CONTROL_WL",
    "PRV_MEXICO_WL", "ISIN_PRV", "OFACPRV"
]


def extract_keyword(filename):
    """
    This extracts only the keyword part:
    E.g., 'BPRV_data.xlsx' -> 'BPRV'
          'PB_PPL_data.xls' -> 'PB_PPL'
    """
    fname = filename.split('.')[0]       # remove extension
    keyword = fname.replace("_data", "") # remove '_data'
    return keyword.upper()


def categorize_keyword(keyword):
    """Match keyword to its category."""
    if keyword in internal_sanctions:
        return "Internal_Sanctions"
    if keyword in internal_non_sanctions:
        return "Internal_NonSanctions"
    if keyword in supplementary_regulatory:
        return "Supplementary_Regulatory"
    return None


folder_path = r"C:\Your\Folder\Path"   # CHANGE THIS

output_files = {
    "Internal_Sanctions": "Internal_Sanctions.xlsx",
    "Internal_NonSanctions": "Internal_NonSanctions.xlsx",
    "Supplementary_Regulatory": "Supplementary_Regulatory.xlsx"
}

# Create Excel writers
writers = {cat: pd.ExcelWriter(output_files[cat], engine='openpyxl') 
           for cat in output_files}

# Process all files
for file in os.listdir(folder_path):
    if file.lower().endswith((".xlsx", ".xls")):

        keyword = extract_keyword(file)
        category = categorize_keyword(keyword)

        if category:
            full_path = os.path.join(folder_path, file)
            df = pd.read_excel(full_path)

            print(f"Writing {file} → {category} → Sheet: {keyword}")
            df.to_excel(writers[category], sheet_name=keyword, index=False)
        else:
            print(f"Skipping (no category match): {file}")

# Save outputs
for w in writers.values():
    w.save()

print("All master files created successfully!")

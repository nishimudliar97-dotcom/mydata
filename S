SELECT
    TRUNC(TO_DATE(Msg.T_COMPLETED, 'YYYY/MM/DD HH24:MI:SS')) AS "Payment Released On",
    Msg.T_DECISION_TYPE AS "Final Decision",
    CASE
        WHEN LOWER(Act.T_COMMENTS) LIKE '%www%' THEN 'www'
        WHEN LOWER(Act.T_COMMENTS) LIKE '%http%' THEN 'http'
        ELSE 'Other'
    END AS "External_Weblinks_Usage",
    COUNT(Msg.T_SYSTEM_ID) AS "Total Count"
FROM SANCTIONS_OWNER.FOF_HIST_MESSAGE Msg
INNER JOIN SANCTIONS_OWNER.FOF_HIST_ACTION Act
    ON Msg.T_SYSTEM_ID = Act.T_SYSTEM_ID
WHERE
    TO_DATE(SUBSTR(Msg.T_COMPLETED, 1, 10), 'YYYY/MM/DD') <= TRUNC(SYSDATE)
    AND TRUNC(TO_DATE(Msg.T_COMPLETED, 'YYYY/MM/DD HH24:MI:SS'))
        BETWEEN DATE '2025-10-19' AND DATE '2025-11-02'
    AND Msg.T_DECISION_TYPE IN ('PASS.LV4', 'PASS.LV3')
    AND (
        LOWER(Act.T_COMMENTS) LIKE '%www%'
        OR LOWER(Act.T_COMMENTS) LIKE '%http%'
    )
    AND LOWER(Act.T_COMMENTS) NOT LIKE '%https://forebears.io%'
GROUP BY
    TRUNC(TO_DATE(Msg.T_COMPLETED, 'YYYY/MM/DD HH24:MI:SS')),
    Msg.T_DECISION_TYPE,
    CASE
        WHEN LOWER(Act.T_COMMENTS) LIKE '%www%' THEN 'www'
        WHEN LOWER(Act.T_COMMENTS) LIKE '%http%' THEN 'http'
        ELSE 'Other'
    END
ORDER BY
    "Payment Released On";
